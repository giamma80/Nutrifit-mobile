############################################################
# Nutrifit Backend – Template .env.example
# Copia questo file in .env (o .env.local) e compila i valori reali.
# Non inserire chiavi reali in questo template.
############################################################

###############################
# 1. AI Meal Photo Adapter
###############################
AI_MEAL_PHOTO_MODE=gpt4v               # gpt4v | model | heuristic | stub
AI_MEAL_ANALYSIS_V2=0                  # 1=nuovo domain service, 0=legacy adapter
AI_GPT4V_REAL_ENABLED=0                # 1=chiamate reali, 0=mock deterministico
OPENAI_VISION_MODEL=gpt-4o-mini        # modello vision
OPENAI_API_KEY=__REPLACE_ME__          # obbligatoria se REAL_ENABLED=1

###############################
# 2. Normalization Pipeline
###############################
AI_NORMALIZATION_MODE=enforce          # off | dry_run | enforce
AI_PHOTO_URL_ALLOWED_HOSTS=firebasestorage.googleapis.com,images.example.com

###############################
# 3. Future Nutrient Sources (placeholder)
###############################
AI_USDA_ENABLED=0
AI_USDA_SNAPSHOT=0
AI_USDA_COOKING=0
AI_USDA_MICROS=0

###############################
# 4. Remote / Heuristic fallback (legacy)
###############################
# AI_REMOTE_ENABLED=0
# AI_HEURISTIC_ENABLED=0
REMOTE_TIMEOUT_MS=1200
REMOTE_LATENCY_MS=900
REMOTE_JITTER_MS=300
REMOTE_FAIL_RATE=0.0

###############################
# 5. Metrics / Observability
###############################
AI_METRICS_PARSE=1
AI_METRICS_NORMALIZATION=1

###############################
# 6. Rate Limiting / Quota (placeholder)
###############################
AI_GPT_DAILY_QUOTA=0
AI_GPT_RATE_LIMIT_PER_MIN=0

###############################
# 7. Domain Configuration (V2 Domini sempre attivi)
###############################
# Nota: Tutti i domini V2 sono stabili e sempre abilitati

###############################
# 8. Supabase Storage (Image Upload)
###############################
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your-anon-key-here            # Anon/public key per storage
SUPABASE_BUCKET=meal-images                # Nome bucket per immagini

###############################
# 9. Logging
###############################
AI_MEAL_PHOTO_DEBUG=0                  # 1=log diagnostici normalization
LOG_LEVEL=INFO                         # DEBUG | INFO | WARNING | ERROR

###############################
# 10. Auth0 Configuration
###############################
AUTH0_DOMAIN=your-tenant.eu.auth0.com
AUTH0_API_IDENTIFIER=https://api.nutrifit.app
AUTH0_ALGORITHMS=["RS256"]

###############################
# 11. Persistence Strategy
###############################
# Global Repository Backend: "inmemory" (default, dev veloce) | "mongodb" (persistenza)
REPOSITORY_BACKEND=inmemory

# MongoDB Configuration (required if REPOSITORY_BACKEND=mongodb)
MONGODB_USER=your_mongodb_user
MONGODB_PASSWORD=your_mongodb_password

# Local Docker MongoDB (development)
#MONGODB_URI=mongodb://${MONGODB_USER}:${MONGODB_PASSWORD}@localhost:27017

# MongoDB Atlas (production) - replace with your cluster URL
#MONGODB_URI=mongodb+srv://${MONGODB_USER}:${MONGODB_PASSWORD}@your-cluster.mongodb.net/nutrifit?retryWrites=true&w=majority

MONGODB_DATABASE=nutrifit

###############################
# NOTE
# - Imposta AI_GPT4V_REAL_ENABLED=1 solo in ambienti sicuri con chiave valida.
# - AI_USDA_* è ora completamente integrato nel sistema di enrichment a 3 tier.
# - Usa LOG_LEVEL=DEBUG in sviluppo per vedere adapter.selected e env.snapshot.
# - Tutti i domini V2 sono production-ready e sempre attivi.
# - SUPABASE_KEY deve essere la chiave anon/public con permessi storage.
# - REPOSITORY_BACKEND: scegli in base al contesto:
#   - inmemory: dev veloce, nessuna dipendenza, dati persi al restart (default)
#   - mongodb: production-like, persistenza completa, richiede MongoDB
# - Per Docker Compose: vedi DOCKER.md per configurazione completa
# - MongoDB credentials: usa ${VAR} syntax per separare user/password dalla URI
###############################
